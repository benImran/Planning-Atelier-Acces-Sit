{% extends "base.html.twig" %}
{% block body %}
    <main id="main-planification-commande">
        <div class="planif-button-h2">
            <h2>Listes et état des commandes </h2>
            {#<button class="ebp2">#}
                {#{% if is_granted('IS_AUTHENTICATED_FULLY') %}#}
                    {#<a class="link" href="{{ path('security_logout') }}">Déconnexion</a>#}
                {#{% endif %}#}
            {#</button>#}
            <img onclick="searchClick()" class="img-event" src="{{ asset('img/magnifier.png') }}" alt="search">
            <button class="six col" id="valide-time">
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    <a id="button-8" class="buttonn" href="{{ path('security_logout') }}">Déconnexion</a>
                {% endif %}
            </button>
        </div>
        <div class="navigation nav-pag">
            {{ knp_pagination_render(pagination) }}
        </div>
        <table>
            <thead> <!-- En-tête du tableau -->
            <tr>
                <th class="ths">Commande (n°CAT)</th>
                <th class="ths">Client</th>
                <th class="ths">Statut</th>
                <th class="ths">Enregistré le</th>
                <th class="ths">Date départ atelier souhaiter</th>
                <th class="ths">Date de fin de fabrication planifiée</th>
                <th class="ths">Date de fin de fabrication réelle</th>
            </tr>
            </thead>
            <tbody> <!-- Corps du tableau -->
            {% for commande in pagination %}
                <tr class="trgrey">
                    <td>
                        {{ commande.documentNumber }}
                        <a href="{{ path('details-commandes', {'id': commande.id }) }}">
                            <img class="edit-img" src="{{ asset('img/logo-edit.png') }}" alt="">
                        </a>
                    </td>
                    <td>{{ commande.customerName }}</td>
                    <td>{{ commande.status }}</td>
                    <td>{{ commande.documentDate|date('d/m/y') }}</td>
                    <td>{{ commande.documentWishDate|date('d/m/y') }}</td>
                    <td>10/11/2018</td>
                    <td>
                        {% if commande.documentEndDateFabric is not null %}
                            {{ commande.documentEndDateFabric|date('d/m/y') }}
                        {% else %}
                            Non-défini
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="navigation nav-pag">
            {{ knp_pagination_render(pagination) }}
        </div>
    </main>

    {% block javascripts %}
        {#<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>#}
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script type="text/javascript" src="{{ asset('js/search.js') }}" ></script>
        <script type="text/javascript">
            function searchClick() {
                swal({
                    text: 'Rechercher votre CAT',
                    content: "input",
                    button: {
                        text: "Rechercher",
                        closeModal: false,
                    },
                })
                    .then(name => {
                        if (!name) throw null;

                        return fetch(`https://itunes.apple.com/search?term=${name}&entity=movie`);
                    })
                    .then(results => {
                        return results.json();
                    })
                    .then(json => {
                        const movie = json.results[0];

                        if (!movie) {
                            return swal("La CAT n'a pas été trouvée");
                        }

                        const name = movie.trackName;
                        const imageURL = movie.artworkUrl100;

                        swal({
                            title: "Résultat de la recherche:",
                            text: name,
                            icon: imageURL,
                        });
                    })
                    .catch(err => {
                        if (err) {
                            swal("Oh noes!", "The AJAX request failed!", "error");
                        } else {
                            swal.stopLoading();
                            swal.close();
                        }
                    });
            }
        </script>

{% endblock %}

{% endblock %}
