{% extends "base.html.twig" %}
{% block body %}
    <section id="main-planification-commande">
        <div class="planif-button-h2">
            <h2>Listes des commandes </h2>
            <img onclick="searchClick()" class="img-event" style="width: 3%; cursor: pointer" src="{{ asset('img/magnifier.png') }}" alt="search">
        </div>
        <table>
            <div class="navigation list-pag">
                {{ knp_pagination_render(pagination) }}
            </div>
            <thead> <!-- En-tête du tableau -->
            <tr>
                <th class="ths">Commande (n°CAT)</th>
                <th class="ths customer-name">Client</th>
                <th class="ths">Statut</th>
                <th class="ths">Date départ atelier souhaiter</th>
                <th class="ths">Date de fin de fabrication planifiée</th>
                <th class="ths">Date de fin de fabrication réelle</th>
            </tr>
            </thead>
            <tbody> <!-- Corps du tableau -->
            {% for commande in pagination %}
                <tr class="trgrey">
                    <td>
                        {{ commande.documentNumber }}
                    </td>
                    <td class="customer-name">{{ commande.customerName }}</td>
                    <td>{{ commande.status }}</td>
                    <td>{{ commande.documentWishDate|date('d/m/y') }}</td>
                    <td></td>
                    <td>
                        {% if commande.documentEndDateFabric is not null %}
                            {{ commande.documentEndDateFabric|date('d/m/y') }}
                        {% else %}
                            Non-défini
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="navigation list-pag">
            {{ knp_pagination_render(pagination) }}
        </div>
    </section>

{% endblock %}

    {% block javascripts %}
        <script type="text/javascript">
            function searchClick() {
                swal({
                    text: 'Rechercher votre CAT',
                    content: "input",
                    button: {
                        text: "Recherche!",
                        closeModal: false,
                    },
                })
                    .then(name => {
                        if (!name) throw null;

                        return fetch(`https://itunes.apple.com/search?term=${name}&entity=movie`);
                    })
                    .then(results => {
                        return results.json();
                    })
                    .then(json => {
                        const movie = json.results[0];

                        if (!movie) {
                            return swal("La CAT n'a pas été trouvée");
                        }

                        const name = movie.trackName;
                        const imageURL = movie.artworkUrl100;

                        swal({
                            title: "Top result:",
                            text: name,
                            icon: imageURL,
                        });
                    })
                    .catch(err => {
                        if (err) {
                            swal("Oh noes!", "The AJAX request failed!", "error");
                        } else {
                            swal.stopLoading();
                            swal.close();
                        }
                    });
            }
        </script>
    {% endblock %}
